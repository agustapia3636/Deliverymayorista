<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Importar productos.json a Firestore</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #05030c;
      color: #fff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      background: #11101c;
      padding: 24px 26px;
      border-radius: 16px;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }
    h1 {
      font-size: 20px;
      margin-bottom: 12px;
    }
    p {
      font-size: 14px;
      opacity: 0.85;
      margin-bottom: 14px;
    }
    button {
      margin-top: 10px;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: linear-gradient(90deg, #ff007a, #ff9800);
      color: #fff;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    }
    button:active {
      transform: scale(0.97);
    }
    #estado {
      margin-top: 14px;
      font-size: 13px;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Importar productos.json a Firestore</h1>
    <p>
      Este importador leerá <code>data/productos.json</code> y creará
      un documento en la colección <strong>productos</strong> por cada ítem.
    </p>
    <button id="btnImportar">IMPORTAR AHORA</button>
    <div id="estado"></div>
  </div>

  <script type="module">
    // =========================
    // 1. Firebase (CDN módulos)
    // =========================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH2dJRTpXpOPUhAERnAkcj_avqbEYCSXE",
      authDomain: "deliverymayorista-8c042.firebaseapp.com",
      projectId: "deliverymayorista-8c042",
      storageBucket: "deliverymayorista-8c042.firebasestorage.app",
      messagingSenderId: "98776210634",
      appId: "1:98776210634:web:5e89cecdb641988d53e833"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const btnImportar = document.getElementById("btnImportar");
    const estadoEl    = document.getElementById("estado");

    // =========================
    // 2. Función de importación
    // =========================
    async function importarProductos() {
      try {
        estadoEl.textContent = "Cargando data/productos.json ...";

        const resp = await fetch("data/productos.json");
        if (!resp.ok) {
          throw new Error("No se pudo leer data/productos.json (" + resp.status + ")");
        }

        const data = await resp.json();

        if (!Array.isArray(data)) {
          throw new Error("El JSON no es un array. Esperaba [ { ...producto }, ... ]");
        }

        const ref = collection(db, "productos");

        let ok = 0;
        let fail = 0;

        estadoEl.textContent = `Importando ${data.length} productos...\nEsto puede tardar unos segundos.`;

        // IMPORTAR UNO POR UNO
        for (const p of data) {
          try {
            await addDoc(ref, p);
            ok++;
            if (ok % 50 === 0) {
              estadoEl.textContent = `Importando... ${ok}/${data.length} productos ok`;
            }
          } catch (e) {
            console.error("Error importando producto:", p, e);
            fail++;
          }
        }

        estadoEl.textContent =
          `✅ Importación COMPLETA\n` +
          `✔ Productos importados correctamente: ${ok}\n` +
          `❗ Errores: ${fail}`;

      } catch (err) {
        console.error(err);
        estadoEl.textContent = "❌ Error: " + err.message;
      }
    }

    btnImportar.addEventListener("click", () => {
      if (confirm("¿Seguro que querés importar TODOS los productos a Firestore?")) {
        importarProductos();
      }
    });
  </script>
</body>
</html>
