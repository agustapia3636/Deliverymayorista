<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Producto | Delivery Mayorista</title>
  <link rel="stylesheet" href="css/estilos.css">
</head>
<body>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-inner">
      <a href="index.html" class="logo-link">Delivery Mayorista</a>
      <a href="catalogo.html" class="topbar-link">Ver cat√°logo</a>
    </div>
  </header>

  <!-- P√ÅGINA DE PRODUCTO -->
  <main class="producto-pagina contenedor">

    <div class="producto-wrapper">

      <!-- Imagen / Galer√≠a -->
      <div id="producto-imagen" class="producto-imagen">
        <img id="imagen-principal" src="" alt="producto" />
        <div id="miniaturas" class="miniaturas"></div>
      </div>

      <!-- Info del producto (se completa por JS) -->
      <div id="producto-info" class="producto-info"></div>

    </div>

    <!-- Navegaci√≥n anterior / siguiente (se completa por JS) -->
    <div id="producto-nav" class="producto-nav"></div>

  </main>

  <!-- FOOTER -->
  <footer class="footer">
    Cat√°logo mayorista ¬∑ Delivery Mayorista
  </footer>

  <!-- üî• L√ìGICA DE LA FICHA DE PRODUCTO -->
  <script>
  // Mismo repo de im√°genes que en el cat√°logo
  const BASE_IMG = "https://raw.githubusercontent.com/agustapia3636/deliverymayorista-img/main";

  async function cargarProducto() {
    try {
      const params = new URLSearchParams(window.location.search);
      const codigo = params.get("codigo");
      console.log("C√≥digo en URL:", codigo);

      const infoDiv = document.getElementById("producto-info");

      // Si no viene c√≥digo en la URL
      if (!codigo) {
        if (infoDiv) {
          infoDiv.innerHTML =
            "<h2>Producto no encontrado</h2><p>Falta el c√≥digo en la URL.</p>";
        }
        return;
      }

      // productos.json est√° en la ra√≠z del repo
      const resp = await fetch("productos.json");
      if (!resp.ok) {
        throw new Error("No se pudo cargar productos.json: " + resp.status);
      }

      const productos = await resp.json();
      console.log("Productos cargados:", productos.length);

      const index = productos.findIndex(p => p.codigo === codigo);
      console.log("√çndice encontrado:", index);

      if (index === -1) {
        if (infoDiv) {
          infoDiv.innerHTML =
            "<h2>Producto no encontrado</h2><p>Verific√° el c√≥digo.</p>";
        }
        return;
      }

      const prod = productos[index];

      // ==========================
      //   IMAGEN PRINCIPAL
      // ==========================
      const imgPrincipal = document.getElementById("imagen-principal");
      if (imgPrincipal) {
        imgPrincipal.src = `${BASE_IMG}/${prod.codigo}.JPG`;
        imgPrincipal.alt = prod.nombre_corto || prod.codigo;
        imgPrincipal.loading = "lazy";
        imgPrincipal.onerror = () => {
          imgPrincipal.src = `${BASE_IMG}/${prod.codigo}.jpg`;
        };
      }

      // (Por ahora no generamos miniaturas, pero el contenedor #miniaturas ya est√° listo)
      const miniaturasDiv = document.getElementById("miniaturas");
      if (miniaturasDiv) {
        miniaturasDiv.innerHTML = ""; // quedar√° vac√≠o hasta que armemos la galer√≠a
      }

      // ==========================
      //   INFO DEL PRODUCTO
      // ==========================
      if (infoDiv) {
        const precioFormateado = prod.precio
          ? `$ ${Number(prod.precio).toLocaleString("es-AR", {
              minimumFractionDigits: 2,
            })}`
          : "";

        infoDiv.innerHTML = `
          <p class="producto-codigo">${prod.codigo}</p>
          <h1 class="producto-titulo">${prod.nombre_corto}</h1>
          ${
            prod.categoria
              ? `<p class="producto-categoria">${prod.categoria}</p>`
              : ""
          }
          ${
            prod.descripcion_larga
              ? `<p class="producto-descripcion">${prod.descripcion_larga}</p>`
              : ""
          }
          ${
            precioFormateado
              ? `<p class="producto-precio">${precioFormateado}</p>`
              : ""
          }
          <div class="producto-acciones">
            <a href="catalogo.html" class="btn-secundario">‚Üê Volver al cat√°logo</a>
            <a href="${armarLinkWhatsApp(prod)}" target="_blank" class="btn-whatsapp">
              Consultar por WhatsApp
            </a>
          </div>
        `;
      }

      // ==========================
      //   NAVEGACI√ìN ANTERIOR / SIGUIENTE
      // ==========================
      const nav = document.getElementById("producto-nav");
      if (nav) {
        const anterior = productos[(index - 1 + productos.length) % productos.length];
        const siguiente = productos[(index + 1) % productos.length];

        nav.innerHTML = `
          <button class="btn-nav" onclick="irAProducto('${anterior.codigo}')">
            ‚Üê ${anterior.codigo}
          </button>
          <button class="btn-nav" onclick="window.location.href='catalogo.html'">
            Volver al listado
          </button>
          <button class="btn-nav" onclick="irAProducto('${siguiente.codigo}')">
            ${siguiente.codigo} ‚Üí
          </button>
        `;
      }
    } catch (error) {
      console.error("Error en cargarProducto:", error);
      const infoDiv = document.getElementById("producto-info");
      if (infoDiv) {
        infoDiv.innerHTML = "<h2>Error</h2><p>No se pudo cargar el producto.</p>";
      }
    }
  }

  // Arma el link de WhatsApp con datos del producto
  function armarLinkWhatsApp(prod) {
    const precio = prod.precio
      ? `$ ${Number(prod.precio).toLocaleString("es-AR", {
          minimumFractionDigits: 2,
        })}`
      : "‚Äî";

    const mensaje = [
      "Hola! Me interesa este producto:",
      "",
      `C√≥digo: ${prod.codigo}`,
      `Producto: ${prod.nombre_corto}`,
      `Precio mayorista: ${precio}`,
      "",
      "¬øMe pas√°s disponibilidad y cantidades m√≠nimas?"
    ].join("\n");

    // Si despu√©s quer√©s poner tu n√∫mero: reemplazar ?text= por /TU_NUMERO?text=
    return `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
  }

  // Cambia de producto desde los botones de navegaci√≥n
  function irAProducto(codigo) {
    window.location.href = `producto.html?codigo=${encodeURIComponent(codigo)}`;
  }

  // Dispara la carga al entrar a la p√°gina
  cargarProducto();
  </script>

</body>
</html>
