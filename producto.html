<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Producto | Delivery Mayorista</title>
  <link rel="stylesheet" href="css/estilos.css">

  <style>
    /* ====== LAYOUT BASE DEL PRODUCTO ====== */
    main.producto-pagina {
      padding: 32px 16px 40px;
    }

    main.producto-pagina .producto-wrapper {
      max-width: 1120px;
      margin: auto;
      display: flex;
      align-items: flex-start;
      gap: 40px;
    }

    main.producto-pagina .producto-imagen img {
      width: 100%;
      border-radius: 20px;
      object-fit: contain;
      background: #0a0a12;
      display: block;
    }

    main.producto-pagina .producto-info {
      flex: 1;
    }

    .producto-acciones {
      display: flex;
      gap: 12px;
      margin-top: 22px;
    }

    .producto-nav {
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ====== MOBILE / TABLET (FIX REAL) ====== */
    @media (max-width: 900px) {

      main.producto-pagina {
        padding: 20px 12px 32px;
      }

      main.producto-pagina .producto-wrapper {
        flex-direction: column;
        gap: 28px;
        padding: 0 12px;
      }

      main.producto-pagina .producto-imagen,
      main.producto-pagina .producto-info {
        width: 100%;
        display: block !important;
      }

      /* TEXTO EN UNA SOLA COLUMNA SIEMPRE */
      main.producto-pagina .producto-info {
        text-align: left;
      }

      .producto-titulo {
        font-size: 28px;
        line-height: 1.15;
        margin-bottom: 6px;
      }

      .producto-categoria {
        display: block;
        margin-top: 4px;
        margin-bottom: 12px;
      }

      .producto-descripcion {
        display: block;
        margin-bottom: 18px;
        font-size: 15px;
        line-height: 1.4;
      }

      .producto-precio {
        font-size: 26px;
        margin-bottom: 10px;
      }

      .producto-stock {
        font-size: 15px;
        margin-bottom: 20px;
      }

      /* BOTONES UNO BAJO DEL OTRO EN CELU */
      .producto-acciones {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
        margin-bottom: 26px;
      }

      .btn-secundario,
      .btn-whatsapp {
        width: 100%;
        justify-content: center;
      }

      .producto-nav {
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
      }
    }

    /* ====== CELULARES CHICOS ====== */
    @media (max-width: 480px) {
      .producto-titulo { font-size: 26px; }
      .producto-precio { font-size: 24px; }
      .producto-descripcion { font-size: 14px; }
    }
  </style>
</head>

<body>

  <!-- === TOPBAR === -->
  <header class="topbar">
    <div class="topbar-inner">
      <a href="index.html" class="logo-link">Delivery Mayorista</a>
      <a href="catalogo.html" class="topbar-link">Ver catálogo</a>
    </div>
  </header>

  <!-- === PRODUCT PAGE === -->
  <main class="producto-pagina contenedor">

    <div class="producto-wrapper">

      <!-- IMAGEN PRINCIPAL -->
      <div id="producto-imagen" class="producto-imagen">
        <img id="imagen-principal" src="" alt="producto" />
        <div id="miniaturas"></div>
      </div>

      <!-- INFO DEL PRODUCTO (DINÁMICO) -->
      <div id="producto-info" class="producto-info"></div>

    </div>

    <!-- NAVEGACIÓN -->
    <div id="producto-nav" class="producto-nav"></div>

  </main>

  <!-- FOOTER -->
  <footer class="footer">
    Catálogo mayorista · Delivery Mayorista
  </footer>

  <!-- === JS DE PRODUCTO === -->
  <script>
  const BASE_IMG = "https://raw.githubusercontent.com/agustapia3636/deliverymayorista-img/main";

  function parsearPrecio(valor) {
    if (typeof valor === "number") return valor;
    if (typeof valor === "string") {
      const limpio = valor.replace(/\./g, "").replace(",", ".");
      const num = Number(limpio);
      return isNaN(num) ? null : num;
    }
    return null;
  }

  function obtenerCodigoDeURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("codigo");
  }

  async function cargarProducto() {
    const codigoURL = obtenerCodigoDeURL();
    const infoDiv = document.getElementById("producto-info");

    if (!codigoURL) {
      infoDiv.innerHTML = "<h2>Producto no encontrado</h2><p>Falta el código en la URL.</p>";
      return;
    }

    try {
      const resp = await fetch("productos.json");
      const data = await resp.json();
      const productos = Array.isArray(data) ? data : (data.productos || []);
      const index = productos.findIndex(p => p["Codigo"] === codigoURL);

      if (index === -1) {
        infoDiv.innerHTML = "<h2>Producto no encontrado</h2><p>Verificá el código.</p>";
        return;
      }

      const prod = productos[index];
      const codigo       = prod["Codigo"];
      const nombreCorto  = prod["Nombre Corto"];
      const categoria    = prod["Categoria Princ"];
      const descLarga    = prod["Descripción Larga"];
      const precioMayor  = parsearPrecio(prod["Precio Mayorista"]);
      const precioCliente= parsearPrecio(prod["Precio Cliente"]);
      const precioUsado  = precioMayor ?? precioCliente;
      const stock        = prod["Stock"];

      /* === IMAGEN === */
      const imgPrincipal = document.getElementById("imagen-principal");
      const urls = [
        `${BASE_IMG}/${codigo}.jpg`,
        `${BASE_IMG}/${codigo}.JPG`
      ];
      let intento = 0;
      const probar = () => {
        if (intento >= urls.length) return;
        imgPrincipal.src = urls[intento];
        intento++;
      };
      imgPrincipal.onerror = probar;
      probar();

      /* === INFO === */
      const precioTexto = precioUsado != null
        ? `$ ${precioUsado.toLocaleString("es-AR", { minimumFractionDigits: 0 })}`
        : "";

      const stockTexto = stock != null
        ? `Stock: ${stock} unidades`
        : "";

      infoDiv.innerHTML = `
        <p class="producto-codigo">${codigo}</p>
        <h1 class="producto-titulo">${nombreCorto}</h1>
        ${categoria ? `<p class="producto-categoria">${categoria}</p>` : ""}
        ${descLarga ? `<p class="producto-descripcion">${descLarga}</p>` : ""}
        ${precioTexto ? `<p class="producto-precio">${precioTexto}</p>` : ""}
        ${stockTexto ? `<p class="producto-stock">${stockTexto}</p>` : ""}

        <div class="producto-acciones">
          <a href="catalogo.html" class="btn-secundario">← Volver al catálogo</a>
          <a href="${armarLinkWhatsApp(prod)}" target="_blank" class="btn-whatsapp">
            Consultar por WhatsApp
          </a>
        </div>
      `;

      /* === NAVEGACIÓN === */
      const nav = document.getElementById("producto-nav");
      const anterior = productos[(index - 1 + productos.length) % productos.length]["Codigo"];
      const siguiente = productos[(index + 1) % productos.length]["Codigo"];

      nav.innerHTML = `
        <button class="btn-nav" onclick="irAProducto('${anterior}')">← ${anterior}</button>
        <button class="btn-nav" onclick="window.location.href='catalogo.html'">Volver al listado</button>
        <button class="btn-nav" onclick="irAProducto('${siguiente}')">${siguiente} →</button>
      `;

    } catch (error) {
      infoDiv.innerHTML = "<h2>Error</h2><p>No se pudo cargar el producto.</p>";
    }
  }

  function armarLinkWhatsApp(prod) {
    const codigo      = prod["Codigo"];
    const nombreCorto = prod["Nombre Corto"];
    const precioMayor = parsearPrecio(prod["Precio Mayorista"]);
    const precioTxt   = precioMayor != null
      ? `$ ${precioMayor.toLocaleString("es-AR", { minimumFractionDigits: 0 })}`
      : "Consultar";

    const mensaje = [
      "Hola! Me interesa este producto:",
      "",
      `Código: ${codigo}`,
      `Producto: ${nombreCorto}`,
      `Precio mayorista: ${precioTxt}`,
      "",
      "¿Me pasás disponibilidad y cantidades mínimas?"
    ].join("\n");

    return `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
  }

  function irAProducto(codigo) {
    window.location.href = `producto.html?codigo=${encodeURIComponent(codigo)}`;
  }

  cargarProducto();
  </script>

</body>
</html>
