<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tu carrito - Delivery Mayorista</title>

<style>
    body {
        background: #0d0f1a;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    header {
        background: linear-gradient(90deg,#ff006e,#ffa400);
        padding: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        font-size: 18px;
    }

    header a {
        color: white;
        text-decoration: none;
        font-size: 15px;
    }

    h2 {
        margin: 16px;
        font-size: 28px;
        font-weight: bold;
    }

    /* ====== TARJETA DEL PRODUCTO ====== */
    .carrito-item {
        display: flex;
        gap: 14px;
        background: #111324;
        border-radius: 16px;
        padding: 16px;
        margin: 16px;
        align-items: flex-start;
    }

    .carrito-item img {
        max-width: 90px !important;
        width: 90px !important;
        height: auto !important;
        border-radius: 8px;
        object-fit: contain;
        background: white;
    }

    .carrito-info {
        flex: 1;
    }

    .carrito-info h3 {
        font-size: 17px;
        font-weight: bold;
        margin: 0 0 6px 0;
    }

    .carrito-info p {
        font-size: 14px;
        margin: 2px 0;
        color: #cfd3e0;
    }

    .precio {
        font-size: 15px;
        color: #ffffff;
        font-weight: bold;
        margin-top: 6px;
    }

    .subtotal {
        font-size: 15px;
        color: #ff3e9c;
        font-weight: bold;
        margin-top: 4px;
    }

    /* ====== BOTONES – + ====== */
    .cantidad-box {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
    }

    .btn-cant {
        background: #ff0077;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        color: white;
        font-size: 20px;
    }

    .cantidad {
        background: white;
        color: black;
        border-radius: 8px;
        padding: 4px 12px;
        font-weight: bold;
        font-size: 16px;
    }

    .btn-eliminar {
        background: #ff4b4b;
        border: none;
        padding: 6px 14px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        margin-top: 6px;
    }

    /* ====== TOTAL ====== */
    .total-box {
        text-align: center;
        margin-top: 25px;
        margin-bottom: 10px;
        font-size: 20px;
        font-weight: bold;
    }

    .nota-stock {
        text-align: center;
        color: #9aa0b5;
        font-size: 13px;
        margin-bottom: 20px;
    }

    /* ====== BOTONES ACCIONES ====== */
    .btn-accion {
        display: block;
        margin: 16px auto;
        padding: 15px;
        width: 90%;
        border-radius: 50px;
        font-size: 17px;
        font-weight: bold;
        text-align: center;
        color: white;
        border: none;
    }

    .btn-vaciar {
        background: #cf2f2f;
    }

    .btn-whatsapp {
        background: #11c230;
        box-shadow: 0 0 10px #11c230;
    }

    .btn-volver {
        background: transparent;
        border: 2px solid #fff;
    }

</style>
</head>

<body>

<header>
    Delivery Mayorista
    <a href="index.html">Ver catálogo</a>
</header>

<h2>Tu carrito</h2>

<div id="carrito-lista"></div>

<div class="total-box" id="carrito-total"></div>
<div class="nota-stock">Total estimado sujeto a stock y últimas actualizaciones.</div>

<button class="btn-accion btn-volver" onclick="window.location='index.html'">← Seguir comprando</button>
<button class="btn-accion btn-vaciar" id="btn-vaciar">Vaciar carrito</button>
<button class="btn-accion btn-whatsapp" id="btn-whatsapp">Enviar pedido por WhatsApp</button>

<script>
/* ================== LÓGICA ================== */
const CLAVE_CARRITO = "dm_carrito";

function leerCarrito() {
    try {
        const raw = localStorage.getItem(CLAVE_CARRITO);
        if (!raw) return [];
        return JSON.parse(raw);
    } catch {
        return [];
    }
}

function guardarCarrito(arr) {
    localStorage.setItem(CLAVE_CARRITO, JSON.stringify(arr));
}

function renderCarrito() {
    const cont = document.getElementById("carrito-lista");
    const spanTotal = document.getElementById("carrito-total");
    const btnVaciar = document.getElementById("btn-vaciar");
    const carrito = leerCarrito();

    if (!carrito.length) {
        cont.innerHTML = "<p style='margin:20px;text-align:center;'>Tu carrito está vacío.</p>";
        spanTotal.textContent = "";
        btnVaciar.disabled = true;
        return;
    }

    btnVaciar.disabled = false;
    cont.innerHTML = "";
    let total = 0;

    carrito.forEach((item, idx) => {
        let precio = Number(item.precio) || 0;
        let cantidad = Number(item.cantidad) || 1;
        let subtotal = precio * cantidad;
        total += subtotal;

        const card = document.createElement("div");
        card.className = "carrito-item";

        card.innerHTML = `
           <img src="${item.img}">
           <div class="carrito-info">
               <h3>${item.nombre}</h3>
               <p>Cod: ${item.codigo}</p>
               <p>Stock disponible: ${item.stock}</p>
               <p class="precio">Unitario: $${precio.toLocaleString()}</p>
               <p class="subtotal">Subtotal: $${subtotal.toLocaleString()}</p>

               <div class="cantidad-box">
                    <button class="btn-cant">-</button>
                    <span class="cantidad">${cantidad}</span>
                    <button class="btn-cant">+</button>
               </div>

               <button class="btn-eliminar">Eliminar</button>
           </div>
        `;

        /* === Eventos === */
        const btnMenos = card.querySelectorAll(".btn-cant")[0];
        const btnMas = card.querySelectorAll(".btn-cant")[1];
        const btnEliminar = card.querySelector(".btn-eliminar");

        btnMenos.onclick = () => {
            if (carrito[idx].cantidad > 1) {
                carrito[idx].cantidad--;
                guardarCarrito(carrito);
                renderCarrito();
            }
        };

        btnMas.onclick = () => {
            carrito[idx].cantidad++;
            guardarCarrito(carrito);
            renderCarrito();
        };

        btnEliminar.onclick = () => {
            carrito.splice(idx, 1);
            guardarCarrito(carrito);
            renderCarrito();
        };

        cont.append(card);
    });

    spanTotal.textContent = `Total (${carrito.length} productos): $${total.toLocaleString()}`;
}

document.getElementById("btn-vaciar").onclick = () => {
    localStorage.removeItem(CLAVE_CARRITO);
    renderCarrito();
};

/* LISTO */
renderCarrito();
</script>

</body>
</html>