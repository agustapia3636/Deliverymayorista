<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tu carrito - Delivery Mayorista</title>

<style>
:root {
  --bg-body: #05030c;
  --bg-card: #11101c;
  --texto-principal: #ffffff;
  --texto-secundario: #d4d4f0;
  --texto-suave: #9b9bb5;
  --rosa: #ff007a;
  --rojo: #ff3b3b;
  --verde: #00b341;
  --gris-borde: #2b2a3a;
  --radio-grande: 20px;
  --fuente: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--fuente);
  background: radial-gradient(circle at top, #141327 0, #05030c 55%);
  color: var(--texto-principal);
  min-height: 100vh;
}

/* HEADER */
header {
  background: linear-gradient(90deg, #ff007a, #ff9800);
  padding: 16px 18px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom-left-radius: 18px;
  border-bottom-right-radius: 18px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.55);
  position: sticky;
  top: 0;
  z-index: 20;
}

.logo-texto {
  font-weight: 700;
  font-size: 18px;
  letter-spacing: 0.06em;
}

.link-catalogo-header {
  font-size: 13px;
  font-weight: 600;
  text-decoration: none;
  color: #fff;
  padding: 8px 14px;
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.25);
}

/* MAIN */
main {
  max-width: 960px;
  margin: 0 auto;
  padding: 16px 14px 32px;
}

.volver-catalogo {
  margin: 8px 2px 10px;
}

.volver-catalogo a {
  color: #c28cff;
  text-decoration: none;
  font-size: 14px;
}

.carrito-titulo {
  font-size: 26px;
  margin: 10px 2px 18px;
  font-weight: 700;
}

/* LISTA */
#carrito-lista {
  display: flex;
  flex-direction: column;
  gap: 18px;
  margin-bottom: 28px;
}

/* ‚≠ê‚≠ê‚≠ê CARD M√ÅS ANCHA ‚≠ê‚≠ê‚≠ê */
.carrito-item {
  background: var(--bg-card);
  border-radius: var(--radio-grande);
  padding: 22px 24px;
  display: flex;
  gap: 22px;
  align-items: flex-start;
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.55);
  max-width: 1050px;
  width: 100%;
  margin: 0 auto;
}

.carrito-item-img {
  flex-shrink: 0;
  width: 90px;
  height: 90px;
  border-radius: 14px;
  background: #05040d;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.carrito-item-img img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.carrito-item-textos {
  flex: 1;
}

.carrito-item-nombre {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.carrito-item-detalle {
  font-size: 14px;
  color: var(--texto-secundario);
  line-height: 1.25;
}

/* ‚≠ê‚≠ê PRECIOS AL CENTRO ‚≠ê‚≠ê */
.carrito-item-precios {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  font-size: 14px;
  color: var(--texto-secundario);
  gap: 3px;
  margin-top: 6px;
}

/* ‚≠ê‚≠ê CONTROLES DE CANTIDAD A LA IZQUIERDA ‚≠ê‚≠ê */
.item-row-bottom {
  display: flex;
  width: 100%;
  align-items: center;
  margin-top: 10px;
  justify-content: space-between;
}

.left-controls {
  display: flex;
  gap: 6px;
  align-items: center;
}

.btn-cant {
  width: 32px;
  height: 32px;
  border: none;
  border-radius: 999px;
  background: var(--rosa);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 19px;
  font-weight: 700;
}

.carrito-item-cantidad {
  min-width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  font-size: 15px;
  font-weight: 600;
  background: #fff;
  color: #111;
  border-radius: 999px;
}

/* BOT√ìN ELIMINAR */
.btn-eliminar {
  border: none;
  border-radius: 999px;
  padding: 10px 22px;
  font-size: 15px;
  font-weight: 600;
  background: var(--rojo);
  color: #fff;
}

/* RESUMEN */
.carrito-resumen {
  margin-top: 6px;
  padding-bottom: 16px;
}

.carrito-resumen-total {
  font-size: 22px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 6px;
}

.carrito-resumen-aviso {
  font-size: 13px;
  color: var(--texto-suave);
  text-align: center;
  margin-bottom: 20px;
}

.btn-grande-borde,
.btn-grande-rojo,
.btn-grande-verde {
  width: 100%;
  border-radius: 999px;
  padding: 14px 18px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-grande-borde { border:1px solid var(--gris-borde); }
.btn-grande-rojo { background: var(--rojo); color:#fff; border:none; }
.btn-grande-verde { background: var(--verde); color:#fff; border:none; }

</style>
</head>

<body>

<header>
  <div class="logo-texto">DELIVERY MAYORISTA</div>
  <a href="catalogo.html" class="link-catalogo-header">Ver cat√°logo</a>
</header>

<main>
  <div class="volver-catalogo">
    <a href="catalogo.html">&larr; Ir al cat√°logo</a>
  </div>

  <h1 class="carrito-titulo">Tu carrito</h1>

  <div id="carrito-lista"></div>

  <section class="carrito-resumen">
    <p class="carrito-resumen-total">
      Total (<span id="carrito-total-items">0</span> productos): 
      $<span id="carrito-total-precio">0</span>
    </p>
    <p class="carrito-resumen-aviso">
      Total estimado sujeto a stock y √∫ltimas actualizaciones.
    </p>

    <button class="btn-grande-borde" id="btn-seguir">‚Üê Seguir comprando</button>
    <button class="btn-grande-rojo" id="btn-vaciar">Vaciar carrito</button>
    <button class="btn-grande-verde" id="btn-whatsapp">Enviar pedido por WhatsApp</button>
  </section>
</main>

<script>
const CLAVE_CARRITO = "dm_carrito";
const TELEFONO_WHATSAPP = "5491112345678";

/* utilidad precio */
function formatearPrecio(v) {
  const n = Number(v)||0;
  return n.toLocaleString("es-AR",{maximumFractionDigits:0});
}

function leerCarrito(){
  try{
    const raw=localStorage.getItem(CLAVE_CARRITO);
    if(!raw) return [];
    const arr=JSON.parse(raw);
    return Array.isArray(arr)?arr:[];
  }catch(e){return[];}
}

function guardarCarrito(c){localStorage.setItem(CLAVE_CARRITO,JSON.stringify(c));}

function renderCarrito(){
  const cont=document.getElementById("carrito-lista");
  const carrito=leerCarrito();
  cont.innerHTML="";

  let totalItems=0;
  let totalPrecio=0;

  carrito.forEach((item,idx)=>{
    const nombre=item.nombre||item["Nombre Corto"]||"Producto";
    const codigo=item.codigo||item.Codigo||"";
    const precio=Number(item.precioMayorista||item.precio||0);
    const stock=Number(item.stock||10);
    const cantidad=Number(item.cantidad||1);
    const subtotal=precio*cantidad;
    const img=item.img||item.imagen||"img/sin-imagen.png";

    totalItems+=cantidad;
    totalPrecio+=subtotal;

    const div=document.createElement("div");
    div.classList.add("carrito-item");

    div.innerHTML=`
      <div class="carrito-item-img">
        <img src="${img}">
      </div>

      <div class="carrito-item-textos">
        <p class="carrito-item-nombre">${nombre}</p>
        <p class="carrito-item-detalle">Cod: ${codigo}</p>
        <p class="carrito-item-detalle">Stock disponible: ${stock}</p>
      </div>

      <div class="carrito-item-precios">
        <span>Unitario: $${formatearPrecio(precio)}</span>
        <span>Subtotal: $${formatearPrecio(subtotal)}</span>
      </div>
    `;

    const bottom=document.createElement("div");
    bottom.classList.add("item-row-bottom");

    bottom.innerHTML=`
      <div class="left-controls">
        <button class="btn-cant btn-menos" data-idx="${idx}">‚àí</button>
        <span class="carrito-item-cantidad">${cantidad}</span>
        <button class="btn-cant btn-mas" data-idx="${idx}">+</button>
      </div>
      <button class="btn-eliminar" data-idx="${idx}">Eliminar</button>
    `;

    div.appendChild(bottom);
    cont.appendChild(div);
  });

  document.getElementById("carrito-total-items").textContent=totalItems;
  document.getElementById("carrito-total-precio").textContent=formatearPrecio(totalPrecio);

  cont.querySelectorAll(".btn-mas").forEach(btn=>{
    btn.onclick=()=>cambiarCantidad(btn.dataset.idx,1);
  });
  cont.querySelectorAll(".btn-menos").forEach(btn=>{
    btn.onclick=()=>cambiarCantidad(btn.dataset.idx,-1);
  });
  cont.querySelectorAll(".btn-eliminar").forEach(btn=>{
    btn.onclick=()=>eliminarItem(btn.dataset.idx);
  });
}

function cambiarCantidad(i,d){
  const c=leerCarrito();
  i=Number(i);
  if(!c[i])return;
  let cant=Number(c[i].cantidad||1)+d;
  const stock=Number(c[i].stock||10);
  if(cant<1)cant=1;
  if(cant>stock)cant=stock;
  c[i].cantidad=cant;
  guardarCarrito(c);
  renderCarrito();
}

function eliminarItem(i){
  const c=leerCarrito();
  c.splice(i,1);
  guardarCarrito(c);
  renderCarrito();
}

document.getElementById("btn-seguir").onclick=()=>location.href="catalogo.html";
document.getElementById("btn-vaciar").onclick=()=>{guardarCarrito([]);renderCarrito();};
document.getElementById("btn-whatsapp").onclick=()=>{
  const c=leerCarrito();
  if(!c.length)return;
  let texto="Hola! Quiero hacer este pedido mayorista:%0A%0A";
  c.forEach(x=>{
    const precio=Number(x.precioMayorista||x.precio||0);
    const subtotal=precio*(x.cantidad||1);
    texto+=`‚Ä¢ ${x.codigo} - ${x.nombre} x ${x.cantidad}u = $${formatearPrecio(subtotal)}%0A`;
  });
  const total=document.getElementById("carrito-total-precio").textContent;
  texto+=`%0Aüîπ Total estimado: $${total}`;
  window.open(`https://wa.me/${TELEFONO_WHATSAPP}?text=${texto}`,"_blank");
};

renderCarrito();
</script>

</body>
</html>