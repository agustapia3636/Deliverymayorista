<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Historial de compras - Delivery Mayorista</title>
  <link rel="stylesheet" href="css/estilos.css" />

  <style>
    /* =============== HISTORIAL UI =============== */
    main { padding: 30px 16px 40px; }
    .historial-wrapper {
      max-width: 1400px; /* FULL ANCHO PRO */
      margin: 0 auto;
    }
    .historial-card {
      background: #0f0f1c;
      border-radius: 18px;
      padding: 22px 22px 26px;
      box-shadow: 0 26px 60px rgba(0, 0, 0, 0.6);
    }
    .historial-header { margin-bottom: 18px; }
    .historial-header h1 { margin: 0; font-size: 1.4rem; }
    .historial-header p { margin: 4px 0 0; font-size: 0.85rem; color: #a6a6d4; }

    .top-actions {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 18px;
    }
    .btn-volver {
      background: #16162a;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 8px 18px;
      font-size:0.85rem;
      cursor:pointer;
      color:#f5f5ff;
    }

    /* =============== FILTROS =============== */
    .filtros-grid {
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:12px;
      margin-bottom:18px;
      align-items:end;
    }
    .filtro-block label {
      display:block;
      font-size:0.78rem;
      color:#c3c3ec;
      margin-bottom:4px;
    }
    .filtro-input, .filtro-select {
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #26263d;
      background:#151526;
      color:#fff;
      font-size:0.86rem;
      outline:none;
    }

    /* =============== RESUMEN =============== */
    .resumen-grid {
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:12px;
      margin-bottom:18px;
    }
    .resumen-card {
      background:#141427;
      border-radius:14px;
      padding:10px 14px;
      border:1px solid rgba(255,255,255,0.04);
    }
    .resumen-label { font-size:0.75rem; color:#a0a0d4; }
    .resumen-value { font-size:1rem; font-weight:600; }
    .resumen-extra { font-size:0.75rem; color:#8c8cb5; }

    /* =============== TABLA =============== */
    .tabla-historial-wrapper {
      margin-top:6px;
      border-radius:16px;
      overflow:hidden;
      background:#121224;
      box-shadow:0 18px 50px rgba(0,0,0,0.6);
    }
    .tabla-historial {
      width:100%;
      border-collapse:collapse;
      font-size:0.86rem;
    }
    .tabla-historial thead { background:#181832; }
    .tabla-historial th, .tabla-historial td {
      padding:10px 14px;
      border-bottom:1px solid #20203a;
      text-align:left;
      vertical-align: top;
    }
    .tabla-historial tbody tr {
      cursor: pointer;
      transition: transform .08s ease, background .08s ease;
    }
    .tabla-historial tbody tr:hover {
      background: rgba(255,255,255,0.03);
    }

    .pill {
      display:inline-block;
      padding:3px 10px;
      border-radius:999px;
      font-size:0.72rem;
      background:#26263c;
      color:#ffd08a;
      text-transform:capitalize;
      white-space: nowrap;
    }
    .pill.ok { color:#101015; background: linear-gradient(90deg,#28d48c,#21bcb4); font-weight:700; }
    .pill.bad { color:#ffd1d1; background:#3a1d2a; border:1px solid rgba(255,0,93,0.35); }
    .pill.neutral { color:#d6d6ff; background:#24243a; border:1px solid rgba(255,255,255,0.06); }

    /* ----------- RESPONSIVE ----------- */
    @media (max-width: 1200px){
      .resumen-grid { grid-template-columns: repeat(3, 1fr); }
      .filtros-grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width:768px) {
      .filtros-grid { grid-template-columns:1fr; }
      .resumen-grid { grid-template-columns:1fr; }

      .tabla-historial,
      .tabla-historial thead,
      .tabla-historial tbody,
      .tabla-historial tr,
      .tabla-historial th,
      .tabla-historial td {
        display:block;
        width:100%;
      }
      .tabla-historial thead { display:none; }
      .tabla-historial tbody tr {
        background:#111121;
        border-radius:14px;
        padding:10px 12px;
        margin-bottom:10px;
        box-shadow:0 16px 40px rgba(0,0,0,0.65);
      }
      .tabla-historial tbody tr td {
        border-bottom:none;
        padding:4px 0;
      }
      .tabla-historial tbody tr td::before {
        content:attr(data-label);
        display:inline-block;
        min-width:110px;
        margin-right:6px;
        font-size:0.74rem;
        color:#9b9bcb;
      }
    }

    /* =============== MODAL COMPROBANTE =============== */
    .modal-backdrop {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:900;
      padding: 14px;
    }
    .modal-detalle {
      background:#111121;
      border-radius:16px;
      width:100%;
      max-width:780px;
      padding:18px 20px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 26px 70px rgba(0,0,0,0.72);
    }
    .modal-header-detalle {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
    }
    .btn-cerrar {
      background:transparent;
      border:none;
      color:#eee;
      font-size:18px;
      cursor:pointer;
      margin-left: 10px;
    }
    .detalle-info {
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:6px 10px;
      font-size:.85rem;
      color: #e9e9ff;
    }
    @media (max-width:768px){
      .detalle-info { grid-template-columns:1fr; }
    }

    .detalle-tabla {
      width:100%;
      border-collapse:collapse;
      margin-top:14px;
      font-size:.85rem;
    }
    .detalle-tabla th, .detalle-tabla td {
      padding:6px 8px;
      border-bottom:1px solid #26263a;
    }
    .detalle-totales {
      margin-top:12px;
      text-align:right;
      font-size:1rem;
      font-weight:600;
    }
    .detalle-notas {
      margin-top:8px;
      font-size:.8rem;
      color: #d6d6ff;
      opacity: .9;
    }

    .audit-box{
      margin-top:10px;
      font-size: .82rem;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.03);
      color:#d6d6ff;
    }
    .audit-box b{ color:#fff; }

    .modal-acciones {
      margin-top:16px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap: wrap;
    }
    .btn-primario {
      border:none;
      padding:7px 14px;
      border-radius:999px;
      cursor:pointer;
      background:linear-gradient(90deg,#28d48c,#21bcb4);
      font-weight:700;
      color:#000;
    }
    .btn-secundario {
      border:none;
      padding:7px 14px;
      border-radius:999px;
      cursor:pointer;
      background:#2b2b44;
      color:#fff;
    }
    .btn-danger {
      border:none;
      padding:7px 14px;
      border-radius:999px;
      cursor:pointer;
      background: linear-gradient(90deg,#ff005d,#ffa400);
      color:#101015;
      font-weight:800;
    }

    /* IMPRESI√ìN (por si imprim√≠s el modal directo) */
    @media print {
      body * { visibility:hidden; }
      #areaImprimible, #areaImprimible * { visibility:visible; }
      #areaImprimible {
        position:absolute;
        left:0;
        top:0;
        width:100%;
      }
    }
  </style>
</head>

<body>

  <header>
    <div class="titulo">Historial de compras</div>

    <div class="nav-panel">
      <button class="btn-secundario" onclick="window.location.href='admin.html'">Productos</button>
      <button class="btn-secundario" onclick="window.location.href='clientes.html'">Clientes</button>
      <button class="btn-secundario" onclick="window.location.href='ventas.html'">Ventas</button>
      <button id="logoutBtn" class="btn-sesion">Cerrar sesi√≥n</button>
    </div>
  </header>

  <main>
    <div class="historial-wrapper">

      <div class="top-actions">
        <button class="btn-volver" onclick="window.location.href='clientes.html'">‚Üê Volver a clientes</button>
      </div>

      <section class="historial-card">
        <div class="historial-header">
          <h1 id="tituloCliente">Historial de compras</h1>
          <p id="subtituloCliente">Seleccion√° un cliente desde el panel de Clientes.</p>
        </div>

        <!-- FILTROS -->
        <div class="filtros-grid">
          <div class="filtro-block">
            <label for="filtroDesde">Desde</label>
            <input id="filtroDesde" type="text" class="filtro-input" placeholder="dd/mm/aaaa" />
          </div>
          <div class="filtro-block">
            <label for="filtroHasta">Hasta</label>
            <input id="filtroHasta" type="text" class="filtro-input" placeholder="dd/mm/aaaa" />
          </div>
          <div class="filtro-block">
            <label for="filtroProducto">Producto (c√≥digo o nombre)</label>
            <input id="filtroProducto" type="text" class="filtro-input" placeholder="Ej: N0001..." />
          </div>
          <div class="filtro-block">
            <label for="filtroPago">Pago</label>
            <select id="filtroPago" class="filtro-select">
              <option value="todas">Todas</option>
              <option value="efectivo">Efectivo</option>
              <option value="transferencia">Transferencia</option>
              <option value="mixto">Mixto</option>
            </select>
          </div>
          <div class="filtro-block">
            <label for="filtroEstado">Estado</label>
            <select id="filtroEstado" class="filtro-select">
              <option value="todas">Todas</option>
              <option value="pendiente">Pendiente</option>
              <option value="pagado">Pagado</option>
              <option value="entregado">Entregado</option>
              <option value="anulada">Anulada</option>
            </select>
          </div>
        </div>

        <!-- RESUMEN -->
        <div class="resumen-grid">
          <div class="resumen-card">
            <div class="resumen-label">Total gastado (cliente)</div>
            <div class="resumen-value" id="totalCliente">$0</div>
            <div class="resumen-extra">Excluye anuladas.</div>
          </div>

          <div class="resumen-card">
            <div class="resumen-label">Total en resultados filtrados</div>
            <div class="resumen-value" id="totalFiltrado">$0</div>
            <div class="resumen-extra">Excluye anuladas.</div>
          </div>

          <div class="resumen-card">
            <div class="resumen-label">Resumen</div>
            <div class="resumen-value" id="resumenConteo">0 ventas</div>
            <div class="resumen-extra">Cantidad en tabla (incluye anuladas si las filtr√°s).</div>
          </div>

          <div class="resumen-card">
            <div class="resumen-label">Efectivo (filtrado)</div>
            <div class="resumen-value" id="sumEf">$0</div>
            <div class="resumen-extra">Excluye anuladas.</div>
          </div>

          <div class="resumen-card">
            <div class="resumen-label">Transferencia (filtrado)</div>
            <div class="resumen-value" id="sumTr">$0</div>
            <div class="resumen-extra">Excluye anuladas.</div>
          </div>

          <div class="resumen-card">
            <div class="resumen-label">Mixto (filtrado)</div>
            <div class="resumen-value" id="sumMx">$0</div>
            <div class="resumen-extra">Excluye anuladas.</div>
          </div>
        </div>

        <!-- TABLA -->
        <div class="tabla-historial-wrapper">
          <table class="tabla-historial">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>N¬∞ Interno</th>
                <th>Cliente</th>
                <th>Producto(s)</th>
                <th>Cantidad</th>
                <th>Total</th>
                <th>Pago</th>
                <th>Estado</th>
                <th>Notas</th>
              </tr>
            </thead>
            <tbody id="tablaHistorial"></tbody>
          </table>
        </div>

      </section>
    </div>
  </main>

  <!-- =============== MODAL COMPROBANTE =============== -->
  <div id="modalDetalle" class="modal-backdrop" style="display:none;">
    <div class="modal-detalle" id="areaImprimible">

      <div class="modal-header-detalle">
        <div>
          <h3 style="margin:0; font-size:1.15rem;">Comprobante de Venta</h3>
          <div style="margin-top:5px; font-size:.75rem; opacity:.7;">Documento no fiscal - Uso interno</div>

          <div style="margin-top:4px; font-size:.75rem; opacity:.85;">
            N¬∫ Interno: <span id="detalleNumero">-</span>
          </div>
        </div>

        <button id="cerrarModalDetalle" class="btn-cerrar">‚úï</button>
      </div>

      <div class="detalle-info">
        <div><strong>Cliente:</strong> <span id="detalleCliente">-</span></div>
        <div><strong>Fecha:</strong> <span id="detalleFecha">-</span></div>
        <div><strong>Pago:</strong> <span id="detallePago">-</span></div>
        <div><strong>Estado:</strong> <span id="detalleEstado">-</span></div>
      </div>

      <table class="detalle-tabla">
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Producto</th>
            <th>Cant.</th>
            <th>Precio</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody id="detalleProductos"></tbody>
      </table>

      <div class="detalle-totales">
        <strong>Total:</strong> <span id="detalleTotal">$0</span>
      </div>

      <div class="detalle-notas">
        <strong>Notas:</strong> <span id="detalleNotas">-</span>
      </div>

      <div id="detalleAudit" class="audit-box" style="display:none;"></div>

      <div class="modal-acciones">
        <button id="btnCompartirWhatsapp" class="btn-primario">üí¨ WhatsApp</button>
        <button id="btnImprimir" class="btn-primario">üñ® Imprimir</button>

        <button id="btnAnular" class="btn-danger" style="display:none;">‚õî Anular</button>
        <button id="btnRestaurar" class="btn-secundario" style="display:none;">‚Ü© Restaurar</button>

        <button id="btnCerrarDetalle" class="btn-secundario">Cerrar</button>
      </div>

    </div>
  </div>

  <!-- ================== SCRIPTS ================== -->
  <script type="module" src="js/auth-guard.js"></script>
  <script type="module" src="js/historial.js"></script>
</body>
</html>
